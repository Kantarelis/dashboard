import os
import dash
from dash import dcc
from dash import html
from dash.dependencies import Input, Output
import dash_bootstrap_components as dbc
from flask import Flask
from dashboard.pyqt5_browser.browser import browser_app
from dashboard.interfaces.init_page import init_page
from dashboard.interfaces.dashboard_main import dashboard_main
from dashboard.callbacks.utilities.init_page_clock import init_page_clock


# ================================== Define relative root position =================================================
root_path = os.getcwd()

# ========================================= Define Server ==========================================================
server = Flask(__name__)

# ======================================= Theme of the app =========================================================
external_stylesheet = dbc.themes.DARKLY

# ========================================= Define the app =========================================================
app = dash.Dash(server=server, external_stylesheets=[external_stylesheet])

# ================================ Define the layout of the app ====================================================
app.layout = html.Div(
    [dcc.Location(id="url", refresh=False), html.Div(id="page-content")],
)

# =============================== Define the title of the application ==============================================
app.title = "Dashboard"

# ==================================================================================================================
# ==================================== Clearing Paths Callbacks ====================================================
# ==================================================================================================================
# clearing_paths_callbacks(app, root_path)


# ==================================================================================================================
# ==================================== Pages Navigation Callback ===================================================
# ==================================================================================================================
@app.callback(Output("page-content", "children"), [Input("url", "pathname")])
def display_page(pathname):
    if pathname == "/":
        # ======================================= Clear Auto Generated Data ========================================
        # ==========================================================================================================
        return init_page
    elif pathname == "/dashboard_main":
        return dashboard_main
    else:
        print("Pathname Error")


# ==================================================================================================================
# ========================================= Utilities Callbacks ====================================================
# ==================================================================================================================
init_page_clock(app)

# ==================================================================================================================
# ========================================= Plots Callbacks ========================================================
# ==================================================================================================================
# figures_callbacks(app, root_path)

# ==================================================================================================================
# =============================== User Inputs Dictionaries Callbacks ===============================================
# ==================================================================================================================
# user_settings_callbacks(app, root_path)

# ==================================================================================================================
# ======================================== Server Initiation =======================================================
# ==================================================================================================================
browser_app(server, argv=["", "--no-sandbox"])
# server.run()
